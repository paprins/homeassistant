####################################################
#                                                  #
#                 HOME ASSISTANT                   #
#                                                  #
####################################################

homeassistant:
  name: Home
  latitude: !secret zone_home_latitude
  longitude: !secret zone_home_longitude
  elevation: !secret zone_home_elevation
  unit_system: metric
  time_zone: Europe/Amsterdam
  internal_url: http://hass.foobar.io
  whitelist_external_dirs:
    - /config
    - /share

  packages: !include_dir_named integrations

  customize: !include customize.yaml

  auth_providers:
    - type: trusted_networks
      trusted_networks:
        - 10.0.1.0/24
      allow_bypass_login: true
    - type: homeassistant

# DO THIS: https://www.home-assistant.io/docs/configuration/splitting_configuration/
    
####################################################
#                                                  #
#                     GENERAL                      #
#                                                  #
####################################################

lovelace:
  mode: yaml

  resources: !include lovelace/resources.yaml

# camera streaming
stream:

#https://home-assistant.io/components/config/
config:

#https://www.home-assistant.io/hassio/
hassio:

#https://home-assistant.io/components/history/
history:

logger: !include includes/system/logger.yaml

http:
  use_x_forwarded_for: true
  trusted_proxies: 10.0.1.20

# Text to speech
tts:
  - platform: google_translate
    cache: true
    cache_dir: /tmp/tts
    time_memory: 300
    base_url: http://10.0.1.200:8123
    service_name: google_say

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Enables the frontend
frontend:
  themes: !include_dir_merge_named themes

#samsungtv:
#  - host: !secret samsungtv_ip
#    name: Samsung TV
#    turn_on_action:
#      - service: wake_on_lan.send_magic_packet
#        data:
#          mac: !secret samsungtv_mac

# https://www.home-assistant.io/integrations/zwave/
zwave:
  usb_path: /dev/serial/by-id/usb-0658_0200-if00

# Enables person component
person:

# Enables system health
system_health:

# Checks for available updates
updater:
  reporting: false

################################################
## Notify
################################################
notify:
  - name: homeassistant
    platform: pushover
    api_key: !secret pushover_api_key
    user_key: !secret pushover_user_key

sensor:
  # https://www.home-assistant.io/integrations/dsmr/
  - platform: dsmr

  - platform: time_date
    display_options:
      - 'time'
      - 'date'

  - platform: dnsip

  - platform: afvalbeheer
    wastecollector: MijnAfvalwijzer
    resources:
      - gft
      - papier
      - pmd
    postcode: !secret afvalbeheer_postcode
    streetnumber: !secret afvalbeheer_streetnumber
    upcomingsensor: 1
    nameprefix: 1
    builtinicons: 1
    dutch: 1

  - platform: template
    sensors:
      afval:
        entity_id: sensor.ophaalkalender_vandaag
        friendly_name: Afval vandaag
        icon_template: mdi:delete
        value_template: >
          {% if is_state('sensor.mijnafvalwijzer_vandaag', 'pmd') %}
            Deze avond pmd buiten zetten!
          {% elif is_state('sensor.mijnafvalwijzer_vandaag', 'gft') %}
            Deze avond gft buiten zetten!
          {% elif is_state('sensor.mijnafvalwijzer_vandaag', 'papier') %}
            Deze avond papier en karton buiten zetten!
          {% endif %}

  - platform: template
    sensors:
      solar_power:
        friendly_name: 'Solar power production'
        unit_of_measurement: 'W'
        value_template: >-
          {{ (1000 * (states("sensor.power_production") | float)) | int }}
      grid_power_consumption:
        friendly_name: 'Grid power consumption'
        unit_of_measurement: 'W'
        value_template: >-
          {{ (1000 * (states("sensor.power_consumption") | float)) | int }}
      grid_power_production:
        friendly_name: 'Grid power production'
        unit_of_measurement: 'W'
        value_template: >-
          {{ (1000 * (states("sensor.power_production") | float)) | int }}
